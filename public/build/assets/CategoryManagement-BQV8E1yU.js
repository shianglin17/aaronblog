import{E,F as V,D as z,C as B,a as j,e as G,c as Y}from"./FormModal-JsXGjxAA.js";import{r as p,i as H,j as K,d as Q,l as q,m as J,n as W,e as f,g as C,o as X,b as i,a as P,u as e,h as w,p as b,_ as Z}from"./app-FFJbPSXQ.js";import{c as S}from"./categoryApi-BgVmnjNp.js";function $(g){const d=p([]),s=p(!1),t=p({page:1,per_page:10,search:"",sort_by:"created_at",sort_direction:"desc"}),c=p({currentPage:1,perPage:10,totalItems:0});async function o(){var l;s.value=!0;try{const a=await S.getList();d.value=a.data,(l=a.meta)!=null&&l.pagination&&(c.value={currentPage:a.meta.pagination.current_page,perPage:a.meta.pagination.per_page,totalItems:a.meta.pagination.total_items})}catch(a){g.error(E.FETCH_FAILED),console.error(a)}finally{s.value=!1}}function r(l){t.value.search=l,t.value.page=1,o()}function m(l){t.value.page=l,o()}function v(l){t.value.per_page=l,t.value.page=1,o()}function _(l){l?(t.value.sort_by=l.columnKey,t.value.sort_direction=l.order==="ascend"?"asc":"desc"):(t.value.sort_by="created_at",t.value.sort_direction="desc"),o()}return{categories:d,loading:s,params:t,pagination:c,fetchCategories:o,handleSearch:r,handlePageChange:m,handlePageSizeChange:v,handleSorterChange:_}}function ee(g,d){const s={name:"",slug:"",description:""},t=H({...s}),c=p(!1),o=p(!1),r=p(null),m=K(()=>o.value?"編輯分類":"新增分類");function v(){Object.assign(t,s),o.value=!1,r.value=null,c.value=!0}function _(a){o.value=!0,r.value=a.id||null,Object.assign(t,{name:a.name,slug:a.slug,description:a.description||""}),c.value=!0}async function l(a){try{o.value&&r.value?(await S.update({id:r.value,data:a}),g.success("分類更新成功")):(await S.create(a),g.success("分類創建成功")),c.value=!1,d()}catch(h){g.error(o.value?E.UPDATE_FAILED:E.CREATE_FAILED),console.error(h)}}return{formModel:t,showForm:c,isEdit:o,editingId:r,formTitle:m,openCreateForm:v,openEditForm:_,handleFormSubmit:l}}function ae(g,d){const s=p(!1),t=p(null);function c(m){t.value=m.id||null,s.value=!0}function o(){t.value=null,s.value=!1}async function r(){if(t.value)try{await S.delete(t.value),g.success("分類刪除成功"),d()}catch(m){g.error(E.DELETE_FAILED),console.error(m)}finally{t.value=null,s.value=!1}}return{showDeleteConfirm:s,deletingId:t,openDeleteConfirm:c,cancelDelete:o,handleDelete:r}}const te={class:"page-header"},ne=Q({__name:"CategoryManagement",setup(g){const d=q(),s=p(""),{categories:t,loading:c,pagination:o,fetchCategories:r,handleSearch:m,handlePageChange:v,handlePageSizeChange:_,handleSorterChange:l}=$(d),{formModel:a,showForm:h,isEdit:A,formTitle:x,openCreateForm:M,openEditForm:T,handleFormSubmit:U}=ee(d,r),{showDeleteConfirm:y,openDeleteConfirm:L,cancelDelete:R,handleDelete:I}=ae(d,r);return J(()=>{r()}),(oe,n)=>{const k=C("n-button"),D=C("n-input"),F=C("n-form-item"),O=C("n-modal"),N=C("n-message-provider");return X(),W(N,null,{default:f(()=>[i(Y,null,{default:f(()=>[P("div",te,[n[8]||(n[8]=P("h1",null,"分類管理",-1)),i(V,{search:s.value,"onUpdate:search":n[0]||(n[0]=u=>s.value=u),onSearch:e(m)},{suffix:f(()=>[i(k,{type:"primary",onClick:e(M)},{default:f(()=>n[7]||(n[7]=[w("新增分類")])),_:1},8,["onClick"])]),_:1},8,["search","onSearch"]),i(z,{columns:e(B),data:e(t),loading:e(c),pagination:e(o),onPageChange:e(v),onPageSizeChange:e(_),onSorterChange:e(l),onEdit:e(T),onDelete:e(L)},null,8,["columns","data","loading","pagination","onPageChange","onPageSizeChange","onSorterChange","onEdit","onDelete"])]),i(j,{show:e(h),"onUpdate:show":n[4]||(n[4]=u=>b(h)?h.value=u:null),modelValue:e(a),"onUpdate:modelValue":n[5]||(n[5]=u=>b(a)?a.value=u:null),title:e(x),rules:e(G),"submit-text":e(A)?"保存":"新增",onSubmit:e(U)},{default:f(()=>[i(F,{label:"名稱",path:"name"},{default:f(()=>[i(D,{value:e(a).name,"onUpdate:value":n[1]||(n[1]=u=>e(a).name=u),placeholder:"請輸入分類名稱"},null,8,["value"])]),_:1}),i(F,{label:"Slug",path:"slug"},{default:f(()=>[i(D,{value:e(a).slug,"onUpdate:value":n[2]||(n[2]=u=>e(a).slug=u),placeholder:"請輸入Slug"},null,8,["value"])]),_:1}),i(F,{label:"描述",path:"description"},{default:f(()=>[i(D,{value:e(a).description,"onUpdate:value":n[3]||(n[3]=u=>e(a).description=u),type:"textarea",placeholder:"請輸入分類描述"},null,8,["value"])]),_:1})]),_:1},8,["show","modelValue","title","rules","submit-text","onSubmit"]),i(O,{show:e(y),"onUpdate:show":n[6]||(n[6]=u=>b(y)?y.value=u:null),preset:"dialog",title:"確認刪除","positive-text":"確認","negative-text":"取消",onPositiveClick:e(I),onNegativeClick:e(R)},{default:f(()=>n[9]||(n[9]=[w(" 確定要刪除這個分類嗎？ ")])),_:1},8,["show","onPositiveClick","onNegativeClick"])]),_:1})]),_:1})}}}),ue=Z(ne,[["__scopeId","data-v-c502b615"]]);export{ue as default};
