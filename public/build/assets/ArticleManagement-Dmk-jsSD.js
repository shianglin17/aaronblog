import{F as re,S as ue,E as N,D as ie,A as ce,a as de,b as pe,c as ge}from"./FormModal-MdfhDy0x.js";import{d as K,c as G,o as q,a as P,r as c,w as M,b as l,e as i,f as ve,g as b,h as z,u as t,_ as H,i as fe,j as me,t as Q,k as V,l as he,m as ye,n as _e,p as R}from"./app-BB3W57iB.js";import{c as J}from"./categoryApi-B4E2IUHI.js";const Ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=K({name:"FilterOutline",render:function(_,a){return q(),G("svg",Ce,a[0]||(a[0]=[P("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M32 144h448"},null,-1),P("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M112 256h288"},null,-1),P("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M208 368h96"},null,-1)]))}}),Se={class:"article-filter-bar"},be={class:"advanced-filters"},Ae={class:"filter-actions"},we=K({__name:"ArticleFilterBar",props:{search:{type:String,default:""},status:{type:String,default:"all"},category:{type:String,default:void 0},tags:{type:Array,default:()=>[]},categoryOptions:{type:Array,default:()=>[]},tagOptions:{type:Array,default:()=>[]}},emits:["search","status-change","category-change","tags-change","reset","update:search","update:status","update:category","update:tags"],setup(y,{emit:_}){const a=y,e=_,u=c(a.search),d=c(a.status),f=c(a.category),p=c(a.tags),C=c(!1);M(()=>a.search,r=>{u.value=r}),M(()=>a.status,r=>{d.value=r}),M(()=>a.category,r=>{f.value=r}),M(()=>a.tags,r=>{p.value=r});function A(r){e("update:search",r),e("search",r)}function w(r){e("update:status",r),e("status-change",r)}function v(r){e("update:category",r),e("category-change",r)}function m(r){e("update:tags",r),e("tags-change",r)}function E(){u.value="",d.value="all",f.value=void 0,p.value=[],e("update:search",""),e("update:status","all"),e("update:category",void 0),e("update:tags",[]),e("reset")}function T(){e("search",u.value),e("status-change",d.value),e("category-change",f.value),e("tags-change",p.value),C.value=!1}function I(){C.value=!C.value}return(r,h)=>{const L=b("n-icon"),U=b("n-button"),D=b("n-select"),g=b("n-form-item"),o=b("n-space"),S=b("n-card"),F=b("n-collapse-transition");return q(),G("div",Se,[l(re,{search:u.value,"onUpdate:search":h[0]||(h[0]=O=>u.value=O),status:d.value,"onUpdate:status":h[1]||(h[1]=O=>d.value=O),"show-status":!0,onSearch:A,onStatusChange:w},{suffix:i(()=>[l(U,{quaternary:"",onClick:I},{default:i(()=>[h[4]||(h[4]=z(" 進階篩選 ")),l(L,null,{default:i(()=>[l(t(Fe))]),_:1})]),_:1}),ve(r.$slots,"suffix",{},void 0,!0)]),_:3},8,["search","status"]),l(F,{show:C.value},{default:i(()=>[P("div",be,[l(S,{size:"small",title:"進階篩選"},{default:i(()=>[l(o,{vertical:""},{default:i(()=>[l(g,{label:"分類"},{default:i(()=>[l(D,{value:f.value,"onUpdate:value":[h[2]||(h[2]=O=>f.value=O),v],options:y.categoryOptions,placeholder:"選擇分類",clearable:""},null,8,["value","options"])]),_:1}),l(g,{label:"標籤"},{default:i(()=>[l(D,{value:p.value,"onUpdate:value":[h[3]||(h[3]=O=>p.value=O),m],options:y.tagOptions,placeholder:"選擇標籤",multiple:"",clearable:""},null,8,["value","options"])]),_:1}),P("div",Ae,[l(o,{justify:"end"},{default:i(()=>[l(U,{size:"small",onClick:E},{default:i(()=>h[5]||(h[5]=[z("重置")])),_:1}),l(U,{type:"primary",size:"small",onClick:T},{default:i(()=>h[6]||(h[6]=[z("套用")])),_:1})]),_:1})])]),_:1})]),_:1})])]),_:1},8,["show"])])}}}),Oe=H(we,[["__scopeId","data-v-ae6629e8"]]);function ke(y){const _=c([]),a=c(!1),e=c({page:1,per_page:10,search:"",status:"all",category:void 0,tags:[]}),u=c({currentPage:1,perPage:10,totalItems:0}),d=c(!1),f=c(ue),p=c(void 0),C=c([]),A=c([]),w=c([]);async function v(){try{const[o,S]=await Promise.all([J.getList(),Q.getList()]);A.value=[{label:"全部",value:"all"},...o.data.map(F=>({label:F.name,value:F.slug}))],w.value=S.data.map(F=>({label:F.name,value:F.slug}))}catch(o){y.error("獲取篩選選項失敗"),console.error(o)}}async function m(){var o;a.value=!0;try{const S={...e.value};p.value&&p.value!=="all"?S.category=p.value:delete S.category,C.value&&C.value.length>0?S.tags=C.value:delete S.tags;const F=await V.admin.getList(S);_.value=F.data,(o=F.meta)!=null&&o.pagination&&(u.value={currentPage:F.meta.pagination.current_page,perPage:F.meta.pagination.per_page,totalItems:F.meta.pagination.total_items})}catch(S){y.error(N.FETCH_FAILED),console.error(S)}finally{a.value=!1}}function E(o){e.value.search=o,e.value.page=1,m()}function T(o){e.value.status=o,e.value.page=1,m()}function I(o){p.value=o==="all"?void 0:o,e.value.page=1,m()}function r(o){C.value=o,e.value.page=1,m()}function h(o){e.value.page=o,m()}function L(o){e.value.per_page=o,e.value.page=1,m()}function U(o){o?(e.value.sort_by=o.columnKey,e.value.sort_direction=o.order==="ascend"?"asc":"desc"):(e.value.sort_by="created_at",e.value.sort_direction="desc"),m()}function D(){e.value.search="",e.value.status="all",p.value=void 0,C.value=[],e.value.page=1,m()}function g(){d.value=!d.value}return{articles:_,loading:a,params:e,pagination:u,filterVisible:d,statusOptions:f,categoryOptions:A,tagOptions:w,categoryFilter:p,tagFilters:C,fetchArticles:m,loadFilterOptions:v,handleSearch:E,handleStatusChange:T,handleCategoryChange:I,handleTagsChange:r,handlePageChange:h,handlePageSizeChange:L,handleSorterChange:U,resetFilters:D,toggleFilterPanel:g}}const k={title:"",slug:"",description:"",content:"",category_id:null,status:"draft",tags:[]};function Ee(y,_){const a=fe({...k,tags:[...k.tags]}),e=c(!1),u=c(!1),d=c(null),f=me(()=>u.value?"編輯文章":"新增文章");function p(){a.title=k.title,a.slug=k.slug,a.description=k.description,a.content=k.content,a.category_id=k.category_id,a.status=k.status,a.tags=[...k.tags],d.value=null}function C(){p(),u.value=!1,e.value=!0}function A(v){var m,E;p(),u.value=!0,d.value=v.id||null,a.title=v.title,a.slug=v.slug||"",a.description=v.description||"",a.content=v.content,a.category_id=((m=v.category)==null?void 0:m.id)||null,a.status=v.status,a.tags=((E=v.tags)==null?void 0:E.map(T=>T.id))||[],e.value=!0}async function w(v){try{u.value&&d.value?(await V.admin.update({id:d.value,data:v}),y.success("文章更新成功")):(await V.admin.create(v),y.success("文章創建成功")),e.value=!1,_()}catch(m){y.error(u.value?N.UPDATE_FAILED:N.CREATE_FAILED),console.error(m)}}return M(e,v=>{v||setTimeout(()=>{p(),u.value=!1},0)}),{formModel:a,showForm:e,isEdit:u,editingId:d,formTitle:f,openCreateForm:C,openEditForm:A,handleFormSubmit:w}}function Te(y,_){const a=c(!1),e=c(null);function u(p){e.value=p.id||null,a.value=!0}function d(){e.value=null,a.value=!1}async function f(){if(e.value)try{await V.admin.delete(e.value),y.success("文章刪除成功"),_()}catch(p){y.error(N.DELETE_FAILED),console.error(p)}finally{e.value=null,a.value=!1}}return{showDeleteConfirm:a,deletingId:e,openDeleteConfirm:u,cancelDelete:d,handleDelete:f}}function Ue(y){const _=c([]),a=c([]);async function e(){try{const[u,d]=await Promise.all([J.getList(),Q.getList()]);_.value=u.data.map(f=>({label:f.name,value:f.id})),a.value=d.data.map(f=>({label:f.name,value:f.id}))}catch(u){y.error("獲取選項失敗"),console.error(u)}}return{categoryOptions:_,tagOptions:a,loadOptions:e}}const xe={class:"page-header"},Pe=K({__name:"ArticleManagement",setup(y){const _=he(),a=c(""),{articles:e,loading:u,params:d,pagination:f,categoryOptions:p,tagOptions:C,categoryFilter:A,tagFilters:w,fetchArticles:v,loadFilterOptions:m,handleSearch:E,handleStatusChange:T,handleCategoryChange:I,handleTagsChange:r,handlePageChange:h,handlePageSizeChange:L,handleSorterChange:U,resetFilters:D}=ke(_),{formModel:g,showForm:o,isEdit:S,formTitle:F,openCreateForm:O,openEditForm:W,handleFormSubmit:X}=Ee(_,v),{showDeleteConfirm:j,openDeleteConfirm:Y,cancelDelete:Z,handleDelete:ee}=Te(_,v),{categoryOptions:te,tagOptions:ae,loadOptions:ne}=Ue(_);return ye(()=>{v(),ne(),m()}),(De,n)=>{const le=b("n-button"),B=b("n-input"),x=b("n-form-item"),$=b("n-select"),oe=b("n-modal"),se=b("n-message-provider");return q(),_e(se,null,{default:i(()=>[l(ge,null,{default:i(()=>[P("div",xe,[n[15]||(n[15]=P("h1",null,"文章管理",-1)),l(Oe,{search:a.value,"onUpdate:search":n[0]||(n[0]=s=>a.value=s),status:t(d).status,"onUpdate:status":n[1]||(n[1]=s=>t(d).status=s),category:t(A),"onUpdate:category":n[2]||(n[2]=s=>R(A)?A.value=s:null),tags:t(w),"onUpdate:tags":n[3]||(n[3]=s=>R(w)?w.value=s:null),"category-options":t(p),"tag-options":t(C),onSearch:t(E),onStatusChange:t(T),onCategoryChange:t(I),onTagsChange:t(r),onReset:t(D)},{suffix:i(()=>[l(le,{type:"primary",onClick:t(O)},{default:i(()=>n[14]||(n[14]=[z("新增文章")])),_:1},8,["onClick"])]),_:1},8,["search","status","category","tags","category-options","tag-options","onSearch","onStatusChange","onCategoryChange","onTagsChange","onReset"]),l(ie,{columns:t(ce),data:t(e),loading:t(u),pagination:t(f),onPageChange:t(h),onPageSizeChange:t(L),onSorterChange:t(U),onEdit:t(W),onDelete:t(Y)},null,8,["columns","data","loading","pagination","onPageChange","onPageSizeChange","onSorterChange","onEdit","onDelete"])]),l(de,{show:t(o),"onUpdate:show":n[11]||(n[11]=s=>R(o)?o.value=s:null),modelValue:t(g),"onUpdate:modelValue":n[12]||(n[12]=s=>R(g)?g.value=s:null),title:t(F),rules:t(pe),"submit-text":t(S)?"保存":"新增",onSubmit:t(X),width:"700px"},{default:i(()=>[l(x,{label:"標題",path:"title"},{default:i(()=>[l(B,{value:t(g).title,"onUpdate:value":n[4]||(n[4]=s=>t(g).title=s),placeholder:"請輸入文章標題"},null,8,["value"])]),_:1}),l(x,{label:"Slug",path:"slug"},{default:i(()=>[l(B,{value:t(g).slug,"onUpdate:value":n[5]||(n[5]=s=>t(g).slug=s),placeholder:"請輸入Slug"},null,8,["value"])]),_:1}),l(x,{label:"描述",path:"description"},{default:i(()=>[l(B,{value:t(g).description,"onUpdate:value":n[6]||(n[6]=s=>t(g).description=s),type:"textarea",placeholder:"請輸入文章描述"},null,8,["value"])]),_:1}),l(x,{label:"分類",path:"category_id"},{default:i(()=>[l($,{value:t(g).category_id,"onUpdate:value":n[7]||(n[7]=s=>t(g).category_id=s),options:t(te),placeholder:"請選擇分類"},null,8,["value","options"])]),_:1}),l(x,{label:"標籤",path:"tags"},{default:i(()=>[l($,{value:t(g).tags,"onUpdate:value":n[8]||(n[8]=s=>t(g).tags=s),options:t(ae),placeholder:"請選擇標籤",multiple:""},null,8,["value","options"])]),_:1}),l(x,{label:"狀態",path:"status"},{default:i(()=>[l($,{value:t(g).status,"onUpdate:value":n[9]||(n[9]=s=>t(g).status=s),options:[{label:"已發布",value:"published"},{label:"草稿",value:"draft"}],placeholder:"請選擇狀態"},null,8,["value"])]),_:1}),l(x,{label:"內容",path:"content"},{default:i(()=>[l(B,{value:t(g).content,"onUpdate:value":n[10]||(n[10]=s=>t(g).content=s),type:"textarea",placeholder:"請輸入文章內容",rows:"10"},null,8,["value"])]),_:1})]),_:1},8,["show","modelValue","title","rules","submit-text","onSubmit"]),l(oe,{show:t(j),"onUpdate:show":n[13]||(n[13]=s=>R(j)?j.value=s:null),preset:"dialog",title:"確認刪除","positive-text":"確認","negative-text":"取消",onPositiveClick:t(ee),onNegativeClick:t(Z)},{default:i(()=>n[16]||(n[16]=[z(" 確定要刪除這篇文章嗎？ ")])),_:1},8,["show","onPositiveClick","onNegativeClick"])]),_:1})]),_:1})}}}),Me=H(Pe,[["__scopeId","data-v-6fbc78ee"]]);export{Me as default};
