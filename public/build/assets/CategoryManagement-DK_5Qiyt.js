import{E,F as V,D as z,C as B,a as j,e as G,c as Y}from"./FormModal-CrkAUENd.js";import{_ as H}from"./app-B2aNZ5QZ.js";import{c as S}from"./categoryApi-CymP0d69.js";import{r as p,e as K,c as Q,k as W,o as X,Z,Y as f,W as C,U as q,X as u,S as P,N as e,j as w,a8 as b}from"./vue-vendor-BzR9iUpD.js";import{u as J}from"./ui-vendor-DUNw84bt.js";import"./markdown-j6I5lR1l.js";/* empty css            */function $(m){const d=p([]),r=p(!1),t=p({page:1,per_page:10,search:"",sort_by:"created_at",sort_direction:"desc"}),c=p({currentPage:1,perPage:10,totalItems:0});async function o(){var l;r.value=!0;try{const a=await S.getList();d.value=a.data,(l=a.meta)!=null&&l.pagination&&(c.value={currentPage:a.meta.pagination.current_page,perPage:a.meta.pagination.per_page,totalItems:a.meta.pagination.total_items})}catch(a){m.error(E.FETCH_FAILED),console.error(a)}finally{r.value=!1}}function s(l){t.value.search=l,t.value.page=1,o()}function g(l){t.value.page=l,o()}function v(l){t.value.per_page=l,t.value.page=1,o()}function _(l){l?(t.value.sort_by=l.columnKey,t.value.sort_direction=l.order==="ascend"?"asc":"desc"):(t.value.sort_by="created_at",t.value.sort_direction="desc"),o()}return{categories:d,loading:r,params:t,pagination:c,fetchCategories:o,handleSearch:s,handlePageChange:g,handlePageSizeChange:v,handleSorterChange:_}}function ee(m,d){const r={name:"",slug:"",description:""},t=K({...r}),c=p(!1),o=p(!1),s=p(null),g=Q(()=>o.value?"編輯分類":"新增分類");function v(){Object.assign(t,r),o.value=!1,s.value=null,c.value=!0}function _(a){o.value=!0,s.value=a.id||null,Object.assign(t,{name:a.name,slug:a.slug,description:a.description||""}),c.value=!0}async function l(a){try{o.value&&s.value?(await S.update({id:s.value,data:a}),m.success("分類更新成功")):(await S.create(a),m.success("分類創建成功")),c.value=!1,d()}catch(h){m.error(o.value?E.UPDATE_FAILED:E.CREATE_FAILED),console.error(h)}}return{formModel:t,showForm:c,isEdit:o,editingId:s,formTitle:g,openCreateForm:v,openEditForm:_,handleFormSubmit:l}}function ae(m,d){const r=p(!1),t=p(null);function c(g){t.value=g.id||null,r.value=!0}function o(){t.value=null,r.value=!1}async function s(){if(t.value)try{await S.delete(t.value),m.success("分類刪除成功"),d()}catch(g){m.error(E.DELETE_FAILED),console.error(g)}finally{t.value=null,r.value=!1}}return{showDeleteConfirm:r,deletingId:t,openDeleteConfirm:c,cancelDelete:o,handleDelete:s}}const te={class:"page-header"},ne=W({__name:"CategoryManagement",setup(m){const d=J(),r=p(""),{categories:t,loading:c,pagination:o,fetchCategories:s,handleSearch:g,handlePageChange:v,handlePageSizeChange:_,handleSorterChange:l}=$(d),{formModel:a,showForm:h,isEdit:A,formTitle:U,openCreateForm:x,openEditForm:M,handleFormSubmit:T}=ee(d,s),{showDeleteConfirm:y,openDeleteConfirm:L,cancelDelete:R,handleDelete:k}=ae(d,s);return X(()=>{s()}),(oe,n)=>{const I=C("n-button"),D=C("n-input"),F=C("n-form-item"),O=C("n-modal"),N=C("n-message-provider");return q(),Z(N,null,{default:f(()=>[u(Y,null,{default:f(()=>[P("div",te,[n[8]||(n[8]=P("h1",null,"分類管理",-1)),u(V,{search:r.value,"onUpdate:search":n[0]||(n[0]=i=>r.value=i),onSearch:e(g)},{suffix:f(()=>[u(I,{type:"primary",onClick:e(x)},{default:f(()=>n[7]||(n[7]=[w("新增分類")])),_:1},8,["onClick"])]),_:1},8,["search","onSearch"]),u(z,{columns:e(B),data:e(t),loading:e(c),pagination:e(o),onPageChange:e(v),onPageSizeChange:e(_),onSorterChange:e(l),onEdit:e(M),onDelete:e(L)},null,8,["columns","data","loading","pagination","onPageChange","onPageSizeChange","onSorterChange","onEdit","onDelete"])]),u(j,{show:e(h),"onUpdate:show":n[4]||(n[4]=i=>b(h)?h.value=i:null),modelValue:e(a),"onUpdate:modelValue":n[5]||(n[5]=i=>b(a)?a.value=i:null),title:e(U),rules:e(G),"submit-text":e(A)?"保存":"新增",onSubmit:e(T)},{default:f(()=>[u(F,{label:"名稱",path:"name"},{default:f(()=>[u(D,{value:e(a).name,"onUpdate:value":n[1]||(n[1]=i=>e(a).name=i),placeholder:"請輸入分類名稱"},null,8,["value"])]),_:1}),u(F,{label:"Slug",path:"slug"},{default:f(()=>[u(D,{value:e(a).slug,"onUpdate:value":n[2]||(n[2]=i=>e(a).slug=i),placeholder:"請輸入Slug"},null,8,["value"])]),_:1}),u(F,{label:"描述",path:"description"},{default:f(()=>[u(D,{value:e(a).description,"onUpdate:value":n[3]||(n[3]=i=>e(a).description=i),type:"textarea",placeholder:"請輸入分類描述"},null,8,["value"])]),_:1})]),_:1},8,["show","modelValue","title","rules","submit-text","onSubmit"]),u(O,{show:e(y),"onUpdate:show":n[6]||(n[6]=i=>b(y)?y.value=i:null),preset:"dialog",title:"確認刪除","positive-text":"確認","negative-text":"取消",onPositiveClick:e(k),onNegativeClick:e(R)},{default:f(()=>n[9]||(n[9]=[w(" 確定要刪除這個分類嗎？ ")])),_:1},8,["show","onPositiveClick","onNegativeClick"])]),_:1})]),_:1})}}}),pe=H(ne,[["__scopeId","data-v-c502b615"]]);export{pe as default};
