# ADR-008: API å›æ‡‰èˆ‡ç•°å¸¸è™•ç†æ¶æ§‹æ¼”é€²

## Status
Accepted - 2025å¹´

## Context
åŸå§‹æ¶æ§‹ä½¿ç”¨ ResponseMaker è™•ç† API å›æ‡‰ï¼Œä½†éš¨è‘—å°ˆæ¡ˆç™¼å±•éœ€è¦æ›´ç°¡æ½”çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ã€‚å€‹äººéƒ¨è½æ ¼ API éœ€è¦ä¸€è‡´çš„å›æ‡‰æ ¼å¼å’Œæ¸…æ™°çš„ç•°å¸¸è™•ç†æµç¨‹ã€‚

**ç›¸é—œ Commit**: é‡æ§‹ç³»åˆ— commit - "éŒ¯èª¤è™•ç†æ¶æ§‹é‡æ§‹"

## Decision
æ¡ç”¨ **ApiResponse + ApiException + å…¨åŸŸç•°å¸¸è™•ç†å™¨** çš„ç¾ä»£åŒ–æ¶æ§‹ã€‚

**æ¶æ§‹æ¼”é€²**:
- v1: ResponseMaker â†’ åŠŸèƒ½åˆ†æ•£ï¼Œä¸å¤ çµ±ä¸€
- v2: Service Exception â†’ æ”¹å–„ä½†å›æ‡‰æ ¼å¼ä¸ä¸€è‡´  
- v3: ApiResponse æ¶æ§‹ â†’ çµ±ä¸€ç°¡æ½”çš„æœ€çµ‚æ–¹æ¡ˆ

**é¸æ“‡ç†ç”±**:
- **çµ±ä¸€å›æ‡‰**: ApiResponse é¡åˆ¥çµ±ä¸€æ‰€æœ‰ API å›æ‡‰æ ¼å¼
- **ç°¡æ½”ç•°å¸¸**: ApiException åŸºé¡ + å…·é«”ç•°å¸¸é¡åˆ¥
- **è‡ªå‹•è™•ç†**: å…¨åŸŸç•°å¸¸è™•ç†å™¨è‡ªå‹•è½‰æ›ç•°å¸¸ç‚º API å›æ‡‰
- **é¡å‹å®‰å…¨**: æ˜ç¢ºçš„ç•°å¸¸é¡å‹å°æ‡‰æ˜ç¢ºçš„ HTTP ç‹€æ…‹ç¢¼

## Consequences

### âœ… æ­£é¢å½±éŸ¿
- **ç¨‹å¼ç¢¼ç°¡åŒ–**: Controller åªéœ€èª¿ç”¨ Serviceï¼Œç„¡éœ€æ‰‹å‹•è™•ç†éŒ¯èª¤
- **æ ¼å¼çµ±ä¸€**: æ‰€æœ‰ API å›æ‡‰æ ¼å¼å®Œå…¨ä¸€è‡´
- **ç•°å¸¸æ˜ç¢º**: å…·é«”ç•°å¸¸é¡åˆ¥æä¾›æ¸…æ™°çš„éŒ¯èª¤è³‡è¨Š
- **ç¶­è­·å®¹æ˜“**: æ–°å¢éŒ¯èª¤é¡å‹åªéœ€æ–°å¢ç•°å¸¸é¡åˆ¥

### âŒ è² é¢å½±éŸ¿
- **å­¸ç¿’æˆæœ¬**: é–‹ç™¼è€…éœ€è¦äº†è§£æ–°çš„ç•°å¸¸è™•ç†æµç¨‹
- **èª¿è©¦è®ŠåŒ–**: éœ€è¦é©æ‡‰å…¨åŸŸç•°å¸¸è™•ç†å™¨çš„èª¿è©¦æ–¹å¼

### ğŸ“Š é‡åŒ–æ•ˆæœ
- Controller ä»£ç¢¼æ¸›å°‘: æ¯å€‹æ–¹æ³•æ¸›å°‘ 5-10 è¡ŒéŒ¯èª¤è™•ç†
- å›æ‡‰æ ¼å¼ä¸€è‡´æ€§: 100% çµ±ä¸€
- ç•°å¸¸é¡å‹: è¦†è“‹æ‰€æœ‰å¸¸è¦‹éŒ¯èª¤å ´æ™¯ (404, 409, 422, 403)

## Implementation

### æ ¸å¿ƒçµ„ä»¶
```php
// çµ±ä¸€å›æ‡‰æ ¼å¼
ApiResponse::ok($data)
ApiResponse::paginated($paginator, $transformer)
ApiResponse::notFound()
ApiResponse::conflict($message)

// ç•°å¸¸è™•ç†
class ApiException extends Exception
class ResourceConflictException extends ApiException

// å…¨åŸŸè™•ç†å™¨
match($e) {
    ModelNotFoundException => ApiResponse::notFound(),
    ApiException => $e->toResponse(),
    ValidationException => ApiResponse::validationError($e->errors())
}
```

## ç›¸é—œæ±ºç­–
- [ADR-005](005-frontend-backend-separation.md) - å‰å¾Œå°åˆ†é›¢çš„ API è¦ç¯„åŸºç¤