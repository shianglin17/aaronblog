# Docker å®¹å™¨åŒ–æ¶æ§‹

## æ¦‚è¿°

Aaron Blog æ¡ç”¨ä¸‰å®¹å™¨ Docker Compose æ¶æ§‹ï¼Œå°ˆç‚º GCP e2-micro å…è²»å±¤å„ªåŒ–ã€‚é€šéç’°å¢ƒå·®ç•°åŒ–é…ç½®å¯¦ç¾é–‹ç™¼èˆ‡ç”Ÿç”¢çš„ä¸€è‡´æ€§ï¼ŒåŒæ™‚é‡å° 1GB RAM é™åˆ¶é€²è¡Œç²¾ç´°çš„è¨˜æ†¶é«”ç®¡ç†ã€‚

## æœå‹™æ¶æ§‹è¨­è¨ˆ

### ä¸‰å±¤å®¹å™¨æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Docker Compose Stack        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ nginx (Alpine)                  â”‚
â”‚  â”œâ”€â”€ éœæ…‹æª”æ¡ˆæœå‹™ (/var/www/public) â”‚
â”‚  â”œâ”€â”€ PHP-FPM ä»£ç† (app:9000)       â”‚
â”‚  â””â”€â”€ è¨˜æ†¶é«”é™åˆ¶: 128MB              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“± app (PHP 8.2-FPM)              â”‚
â”‚  â”œâ”€â”€ Laravel æ‡‰ç”¨æ ¸å¿ƒ               â”‚
â”‚  â”œâ”€â”€ SQLite è³‡æ–™åº«å­˜å–              â”‚
â”‚  â””â”€â”€ è¨˜æ†¶é«”é™åˆ¶: 512MB              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ redis (7-alpine)               â”‚
â”‚  â”œâ”€â”€ æ‡‰ç”¨ç¨‹å¼å¿«å– (maxmemory 100MB) â”‚
â”‚  â”œâ”€â”€ Session å„²å­˜                  â”‚
â”‚  â””â”€â”€ è¨˜æ†¶é«”é™åˆ¶: 128MB              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨˜æ†¶é«”é…ç½®ç­–ç•¥ (GCP e2-micro 1GB)

**è¨˜æ†¶é«”åˆ†é…ç²¾ç®—**
- **app å®¹å™¨**: 512MB limit / 256MB reserved
- **nginx å®¹å™¨**: 128MB limit / 64MB reserved  
- **redis å®¹å™¨**: 128MB limit + 100MB maxmemory
- **ç³»çµ±ä¿ç•™**: ~300MB (OS + Docker overhead)
- **ç¸½ä½¿ç”¨ç‡**: ~95% è¨˜æ†¶é«”åˆ©ç”¨ç‡

## ç’°å¢ƒå·®ç•°åŒ–é…ç½®

### é–‹ç™¼ç’°å¢ƒç­–ç•¥ (docker-compose.yml)

**é–‹ç™¼æœ€ä½³åŒ–ç‰¹æ€§**
- **å³æ™‚é–‹ç™¼**: å®Œæ•´ä»£ç¢¼ç›®éŒ„æ›è¼‰ (`.:/var/www`)
- **é™¤éŒ¯æ¨¡å¼**: `APP_DEBUG=true` + `APP_ENV=local`
- **ç«¯å£é¿è¡**: nginx:8080, redis:6380 (éæ¨™æº–ç«¯å£)
- **æœ¬åœ°å»ºæ§‹**: `build: .` æ”¯æ´å³æ™‚ä»£ç¢¼ä¿®æ”¹
- **é–‹ç™¼å‹å¥½**: nginx ä½¿ç”¨ `default.dev.conf` é…ç½®

**Volume æ›è¼‰ç­–ç•¥**
- **å…¨ç›®éŒ„æ›è¼‰**: æ”¯æ´ Laravel artisan æŒ‡ä»¤å’Œå³æ™‚ä¿®æ”¹
- **ç„¡è¨˜æ†¶é«”é™åˆ¶**: é–‹ç™¼ç’°å¢ƒä¸é™åˆ¶å®¹å™¨è¨˜æ†¶é«”ä½¿ç”¨  
- **ç¶²è·¯æš´éœ²**: Redis 6380 ç«¯å£å¤–éœ²æ–¹ä¾¿é™¤éŒ¯å·¥å…·é€£æ¥

### ç”Ÿç”¢ç’°å¢ƒç­–ç•¥ (docker-compose.gcp.yml)

**GCP éƒ¨ç½²æœ€ä½³åŒ–**
- **é å»ºæ˜ åƒ**: `aaronlei17/aaronblog-app:latest` æ¸›å°‘éƒ¨ç½²æ™‚é–“
- **å”¯è®€æ›è¼‰**: `./public:/var/www/public:ro` å®‰å…¨æ€§æœ€ä½³åŒ–
- **æŒä¹…åŒ–å­˜å„²**: SQLite é€é `sqlite-storage` volume æŒä¹…åŒ–
- **æ¨™æº–ç«¯å£**: nginx 80/443 ç«¯å£ï¼Œç¬¦åˆç”Ÿç”¢ç’°å¢ƒéœ€æ±‚

**è¨˜æ†¶é«”ç²¾ç´°æ§åˆ¶**
- **app**: `mem_limit: 512m` + `mem_reservation: 256m`
- **nginx**: `mem_limit: 128m` + `mem_reservation: 64m`  
- **redis**: `mem_limit: 128m` + `--maxmemory 100mb --maxmemory-policy allkeys-lru`
- **é‡å•Ÿç­–ç•¥**: `restart: unless-stopped` ç¢ºä¿æœå‹™ç©©å®šæ€§

## Dockerfile æ¶æ§‹è¨­è¨ˆ

### å–®éšæ®µ PHP-FPM å®¹å™¨

**åŸºç¤æ˜ åƒ**: `php:8.2-fpm` (å®˜æ–¹ PHP-FPM åŸºç¤æ˜ åƒ)

**æ ¸å¿ƒä¾è³´å®‰è£**
- **ç³»çµ±å¥—ä»¶**: libpng-dev, libxml2-dev, libsqlite3-dev, sqlite3
- **PHP æ“´å……**: `pdo_mysql`, `pdo_sqlite`, `redis`  
- **å·¥å…·ç¨‹å¼**: git, curl, zip, unzip
- **Composer**: å¾å®˜æ–¹æ˜ åƒè¤‡è£½ `composer:2.5`

**ç›®éŒ„æ¬Šé™ç­–ç•¥**
- **å·¥ä½œç›®éŒ„**: `/var/www` (Laravel æ¨™æº–é…ç½®)
- **æ¬Šé™è¨­å®š**: `www-data:www-data` æ“æœ‰æ¬Š
- **å¿…è¦ç›®éŒ„**: é å»ºç«‹ `storage/*`, `bootstrap/cache`, `database` ç›®éŒ„

**ç”Ÿç”¢ç’°å¢ƒå„ªåŒ–**
- **Composer å®‰è£**: `--no-interaction --prefer-dist --optimize-autoloader --no-dev`
- **å¿«å–æ¸…ç†**: `rm -rf /var/lib/apt/lists/*` æ¸›å°‘æ˜ åƒå¤§å°  
- **æª”æ¡ˆè¤‡è£½**: é€é `.dockerignore` æ’é™¤ä¸å¿…è¦æª”æ¡ˆ

## è³‡æ–™æŒä¹…åŒ–ç­–ç•¥

### Volume ç®¡ç†æ¶æ§‹

**é–‹ç™¼ç’°å¢ƒ Volume**
- **å®Œæ•´æ›è¼‰**: `.:/var/www` (å³æ™‚é–‹ç™¼æ”¯æ´)
- **éœæ…‹æª”æ¡ˆ**: `./public:/var/www/public` (nginx ç›´æ¥å­˜å–)

**ç”Ÿç”¢ç’°å¢ƒ Volume**
- **å”¯è®€æ›è¼‰**: `./public:/var/www/public:ro` (å®‰å…¨æ€§å„ªå…ˆ)
- **SQLite æŒä¹…åŒ–**: `sqlite-storage:/var/www/storage/app/database`
- **æ—¥èªŒæŒä¹…åŒ–**: `./storage/logs:/var/www/storage/logs`
- **ç’°å¢ƒé…ç½®**: `.env:/var/www/.env` (å‹•æ…‹é…ç½®)

## ç¶²è·¯èˆ‡ç«¯å£ç­–ç•¥

### Bridge ç¶²è·¯æ¶æ§‹

**å…§éƒ¨é€šè¨Šç¶²è·¯**: `aaronblog-net` (Docker bridge)
- **nginx â†’ app**: FastCGI é€šè¨Š (app:9000)
- **app â†’ redis**: Redis å”è­° (redis:6379)  
- **å…§éƒ¨ DNS**: å®¹å™¨åç¨±è‡ªå‹•è§£æ

**ç«¯å£æ˜ å°„ç­–ç•¥**
- **é–‹ç™¼ç’°å¢ƒ**: nginx:8080, redis:6380 (é¿å…æœ¬åœ°è¡çª)
- **ç”Ÿç”¢ç’°å¢ƒ**: nginx:80/443 (æ¨™æº– HTTP/HTTPS ç«¯å£)
- **å…§éƒ¨ç«¯å£**: redis:6379, app:9000 (ä¸å°å¤–æš´éœ²)

---

*Docker å®¹å™¨åŒ–æ¶æ§‹ç‚º Aaron Blog æä¾›ç’°å¢ƒä¸€è‡´æ€§å’Œ GCP å…è²»å±¤å„ªåŒ–ï¼Œé€éç²¾ç´°çš„è¨˜æ†¶é«”ç®¡ç†å¯¦ç¾æœ€ä½³è³‡æºåˆ©ç”¨ç‡ã€‚*
