# 文章管理模組架構

## 模組概述

文章管理模組是系統的核心功能，負責處理文章的完整生命週期管理，包括創建、讀取、更新、刪除（CRUD）操作，以及文章的分類、標籤、搜尋和快取機制。

## 架構設計

### 分層架構

```
┌─────────────────────────────────────┐
│        Article Management Module    │
├─────────────────────────────────────┤
│  ArticleController                  │
│  ├── index() - 文章列表              │
│  ├── show() - 文章詳情               │
│  ├── store() - 創建文章              │
│  ├── update() - 更新文章             │
│  └── destroy() - 刪除文章            │
├─────────────────────────────────────┤
│  ArticleService                     │
│  ├── getArticles() - 獲取文章列表     │
│  ├── getArticleById() - 獲取文章詳情  │
│  ├── createArticle() - 創建文章      │
│  ├── updateArticle() - 更新文章      │
│  └── deleteArticle() - 刪除文章      │
├─────────────────────────────────────┤
│  ArticleRepository                  │
│  ├── getArticles() - 資料庫查詢      │
│  ├── getById() - 單筆查詢           │
│  ├── create() - 資料創建            │
│  ├── update() - 資料更新            │
│  └── delete() - 資料刪除            │
├─────────────────────────────────────┤
│  ArticleCacheService                │
│  ├── cacheArticleList() - 列表快取   │
│  ├── cacheDetail() - 詳情快取       │
│  └── clearCache() - 快取清除        │
└─────────────────────────────────────┘
```

### 資料流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Controller │────▶│   Service   │────▶│ Repository  │
│             │     │             │     │             │
│  HTTP 請求   │     │  業務邏輯    │     │  資料存取    │
│  回應處理    │     │  快取整合    │     │  查詢優化    │
└─────────────┘     └─────────────┘     └─────────────┘
                            │
                            ▼
                    ┌─────────────┐
                    │ CacheService│
                    │             │
                    │  快取管理    │
                    │  性能優化    │
                    └─────────────┘
```

## 核心組件

### 1. ArticleController
**職責：**
- 處理 HTTP 請求和回應
- 參數驗證和格式化
- 統一的錯誤處理

**主要方法：**
- `index()`: 文章列表查詢（支援搜尋、分類、標籤篩選）
- `show()`: 文章詳情顯示
- `store()`: 創建新文章（管理員功能）
- `update()`: 更新文章（管理員功能）
- `destroy()`: 刪除文章（管理員功能）

### 2. ArticleService
**職責：**
- 業務邏輯處理
- 快取策略整合
- 資料關聯管理

**核心特性：**
- 整合快取服務提升性能
- 處理文章與標籤的多對多關聯
- 統一的錯誤處理與回應格式

### 3. ArticleRepository
**職責：**
- 資料庫查詢優化
- 關聯預載入
- 查詢條件處理

**查詢優化策略：**
- 使用 `select()` 指定必要欄位
- 預載入相關資料（`with()`）
- 條件式查詢（`when()`）

## 功能特性

### 1. 文章 CRUD 操作
- **創建文章**：支援 Markdown 格式、自動生成 SEO 友善 slug、分類標籤關聯
- **查詢文章**：分頁查詢、全文搜尋、分類標籤篩選、狀態篩選、排序功能
- **更新文章**：部分更新支援、標籤關聯同步、快取自動清除
- **刪除文章**：永久刪除機制、關聯資料清理、快取清除

### 2. 搜尋功能
- **搜尋範圍**：文章標題、內容、描述
- **搜尋策略**：使用 `LIKE` 查詢實現模糊搜尋，支援多欄位搜尋

### 3. 分類標籤系統
- **分類關聯**：文章與分類一對多關係，支援分類 slug 查詢
- **標籤關聯**：文章與標籤多對多關係，支援多標籤篩選

### 4. 狀態管理
- **文章狀態**：`draft`（草稿）、`published`（已發布）、`archived`（已封存）
- **狀態控制**：公開 API 僅顯示已發布文章，管理員 API 可查看所有狀態

## 快取策略

### 1. 多層快取架構
- **列表快取**：24小時 TTL，支援參數化快取鍵
- **詳情快取**：3天 TTL，基於文章 ID 的快取
- **Cache Tags**：精確的快取清除機制

### 2. 快取鍵設計
- **列表快取鍵**：`articles:list:{hash}`（基於查詢參數生成）
- **詳情快取鍵**：`articles:detail:{id}`
- **Cache Tags**：`articles`、`article:{id}`

### 3. 快取清除策略
- **創建文章**：清除列表快取
- **更新文章**：清除列表快取和該文章詳情快取
- **刪除文章**：清除所有相關快取

## 資料關聯

### 核心資料表
- **articles**：文章主表
- **categories**：分類表
- **tags**：標籤表
- **article_tag**：文章標籤關聯表

### 關聯設計
```
Article (N) ←→ (1) Category
Article (N) ←→ (M) Tag
Article (N) ←→ (1) User (Author)
```

## API 設計

### 公開 API
- `GET /api/articles` - 文章列表
- `GET /api/articles/{id}` - 文章詳情

### 管理員 API
- `POST /api/admin/articles` - 創建文章
- `PUT /api/admin/articles/{id}` - 更新文章
- `DELETE /api/admin/articles/{id}` - 刪除文章

## 性能優化

### 1. 資料庫優化
- 適當的索引設計（title, status, created_at）
- 關聯預載入避免 N+1 問題
- 查詢欄位選擇優化

### 2. 快取優化
- 多層快取策略
- 參數化快取鍵
- 智能快取清除

### 3. 分頁優化
- 使用 Laravel 的 `paginate()` 方法
- 支援自定義分頁參數
- 回應格式標準化

---

*此文章管理模組展現了現代 Laravel 應用的最佳實踐，包括分層架構、Repository Pattern、快取策略和 API 設計。* 